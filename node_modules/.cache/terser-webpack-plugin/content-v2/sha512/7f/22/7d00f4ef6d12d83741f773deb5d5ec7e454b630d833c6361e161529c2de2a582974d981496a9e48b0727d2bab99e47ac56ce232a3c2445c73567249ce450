{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{169:function(e,t,n){\"use strict\";n.r(t);var o=n(0),r=Object(o.a)({},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",{staticClass:\"content\"},[e._m(0),e._v(\" \"),e._m(1),e._v(\" \"),n(\"p\",[e._v(\"This tutorial presents how to assemble a formula (RAPL-formula) and a sensor\\n(HWPC-sensor) to build a power meter that monitor the power consumption of each\\nCPU socket.\")]),e._v(\" \"),n(\"p\",[e._v(\"First of all, we describe the power meter that we want to build. Then, we\\ndescribe how to deploy the power meter's component and how to connect\\nthem. Each component could be deployed with docker or directly by installing it\\non the system.\")]),e._v(\" \"),e._m(2),e._v(\" \"),n(\"p\",[e._v(\"The power meter will use hardware counters that exist only on Intel CPU with\\nSandy Bridge architecture or higher. The power meter can't be used without\\ntheses counters.\")]),e._v(\" \"),e._m(3),e._v(\" \"),n(\"p\",[e._v(\"Power meter estimations are based on the Running Average Power Limit (RAPL)\\ntechnology. RAPL provide a set of hardware counters that report data about the\\ncurrent energy consumption of each CPU socket. The power meter use the\\nHWPC-sensor to collect these data and send them to the RAPL-formula to compute\\nthe current energy consumption of monitored sockets.\")]),e._v(\" \"),n(\"p\",[e._v(\"Each component of the power meter could be hosted on a different machine. In\\nthis tutorial, we assume that each component are hosted on the same machine.\")]),e._v(\" \"),e._m(4),e._v(\" \"),n(\"p\",[e._v(\"As explained \"),n(\"router-link\",{attrs:{to:\"./powerapi_howitworks.html#power-meter-architecture\"}},[e._v(\"here\")]),e._v(\" The power\\nmeter need two mongoDB databases to connect the formula to the sensor and to\\nstore the power consumption information computed by the formula.\")],1),e._v(\" \"),e._m(5),e._v(\" \"),e._m(6),e._v(\" \"),e._m(7),e._v(\" \"),e._m(8),e._v(\" \"),e._m(9),e._v(\" \"),n(\"p\",[e._v(\"Power information data are structured as this json format :\")]),e._v(\" \"),e._m(10),e._v(\" \"),n(\"p\",[e._v(\"For example to display a power consumption report with the mongo client :\")]),e._v(\" \"),e._m(11),e._v(\" \"),e._m(12),e._v(\" \"),n(\"p\",[e._v(\"This section present how to deploy and connect each component of the power\\nmeter with docker. You will see how to :\")]),e._v(\" \"),e._m(13),e._v(\" \"),e._m(14),e._v(\" \"),n(\"p\",[e._v(\"Download components image :\")]),e._v(\" \"),e._m(15),e._v(\" \"),n(\"p\",[e._v(\"Setup a docker network that will be used to connect each containers\")]),e._v(\" \"),e._m(16),e._v(\" \"),e._m(17),e._v(\" \"),n(\"p\",[e._v(\"Launch the mongoDB instance :\")]),e._v(\" \"),e._m(18),e._v(\" \"),n(\"p\",[e._v(\"Launch the sensor :\")]),e._v(\" \"),e._m(19),e._v(\" \"),n(\"p\",[e._v(\"Launch the formula :\")]),e._v(\" \"),e._m(20),e._v(\" \"),e._m(21),e._v(\" \"),n(\"p\",[e._v(\"This section present how to deploy and connect each component of the power\\nmeter without docker, by installing each of them on the monitored machine. You\\nwill see how to :\")]),e._v(\" \"),e._m(22),e._v(\" \"),e._m(23),e._v(\" \"),e._m(24),e._v(\" \"),e._m(25),e._v(\" \"),n(\"p\",[e._v(\"install the sensor from sources\")]),e._v(\" \"),e._m(26),e._v(\" \"),n(\"p\",[e._v(\"install the RAPL-formula\")]),e._v(\" \"),e._m(27),e._v(\" \"),e._m(28),e._v(\" \"),n(\"p\",[e._v(\"On the HWPC-sensor repository launch the sensor :\")]),e._v(\" \"),e._m(29),e._v(\" \"),n(\"p\",[e._v(\"launch the formula\")]),e._v(\" \"),e._m(30)])},[function(){var e=this.$createElement,t=this._self._c||e;return t(\"h1\",{attrs:{id:\"how-to-monitor-power-consumption-of-a-socket\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#how-to-monitor-power-consumption-of-a-socket\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" How to monitor power consumption of a socket\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"introduction\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#introduction\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Introduction\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"compatible-architecture\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#compatible-architecture\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Compatible Architecture\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"power-meter-description\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#power-meter-description\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Power meter description\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"data-and-database\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#data-and-database\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Data and database\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"We assume that this two databases are hosted on the same mongoDB instance but\\ndifferent instances could be used for each database. In the rest of its\\ntutorial, the URI of the mongoDB instance will be \"),t(\"code\",[this._v(\"mongo://ADDR\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"The first database (that connect the formula and the sensor) will be called\\n\"),t(\"code\",[this._v(\"connection_db\")]),this._v(\" and the data will be store on the \"),t(\"code\",[this._v(\"hwrep\")]),this._v(\" collection.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"The second database (that store power consumption computed by the formula) will\\nbe called \"),t(\"code\",[this._v(\"output_db\")]),this._v(\" and data will be stored on the \"),t(\"code\",[this._v(\"power_consumption\")]),this._v(\"\\ncollection.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"get-power-meter-result\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#get-power-meter-result\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Get power meter result\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"To access to the power consumption information computed by the power meter just\\nconnect a mongo client to the mongoDB instance and retrieve the data of the\\n\"),t(\"code\",[this._v(\"power_consumption\")]),this._v(\" collection of the \"),t(\"code\",[this._v(\"output_db\")]),this._v(\" database.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v('{\\n    \"_id\" : XXX # MongoDB object identifier (string)\\n    \"timestamp\" : YYY # timestamp of the power measure (iso date)\\n    \"metadata\" : {\\n            \"socket\" : \"N\", # socket identifier (int)\\n    },\\n    \"power\" : Z.ZZZ # power consumption expressed in watts (float)\\n}\\n')])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"mongo ADDR\\nuse output_db\\ndb.power_consumption.findOne()\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"deployment-with-docker\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#deployment-with-docker\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Deployment with docker\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"ul\",[t(\"li\",[this._v(\"deploy a mongoDB instance in a docker container\")]),this._v(\" \"),t(\"li\",[this._v(\"deploy the HWPC-sensor in a docker container and connect it to the mongoDB instance\")]),this._v(\" \"),t(\"li\",[this._v(\"deploy the RAPL-formula in a docker container and connect it to the mongoDB instance\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h3\",{attrs:{id:\"setup-docker-environment\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#setup-docker-environment\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Setup docker environment\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"docker pull powerapi/hwpc-sensor\\ndocker pull powerapi/rapl-formula\\ndocker pull mongo\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"docker network create powerapi\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h3\",{attrs:{id:\"launch-the-different-component\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#launch-the-different-component\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Launch the different component\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"docker run -td --name powerapi-mongo --net=powerapi -p 27017:27017 mongo\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v('docker run --net=powerapi --privileged --name powerapi-sensor -td -v /sys:/sys -v /var/lib/docker/containers:/var/lib/docker/containers:ro -v /tmp/powerapi-sensor-reporting:/reporting powerapi/hwpc-sensor -n \"test-sensor\" -r \"mongodb\" -U \"mongodb://powerapi-mongo\" -D \"connection_db\" -C \"hwrep\" -s \"rapl\" -o -e \"RAPL_ENERGY_CORES\" -e \"RAPL_ENERGY_PKG\" -e \"RAPL_ENERGY_GPU\"\\n')])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"docker run -td --net=powerapi --name powerapi-formula powerapi/rapl-formula mongodb://powerapi-mongo connection_db hwrep mongodb://powerapi-mongo output_db power_consumption -s\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"deployment-without-docker\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#deployment-without-docker\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Deployment without docker\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"ul\",[t(\"li\",[this._v(\"compile the HWPC-sensor and connect it to an existing mongoDB instance\")]),this._v(\" \"),t(\"li\",[this._v(\"install the RAPL-formula and connect it to an existing mongoDB instance\")]),this._v(\" \"),t(\"li\",[this._v(\"launch the sensor and the formula from the command line\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h3\",{attrs:{id:\"prerequisites\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Prerequisites\")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"ul\",[n(\"li\",[e._v(\"python 3.7\")]),e._v(\" \"),n(\"li\",[e._v(\"pip\")]),e._v(\" \"),n(\"li\",[e._v(\"a mongoDB instance runing and accessible from the address \"),n(\"code\",[e._v(\"mongodb://ADDR\")])]),e._v(\" \"),n(\"li\",[e._v(\"root privilege to launch the sensor\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h3\",{attrs:{id:\"component-installation\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#component-installation\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Component installation\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"git clone https://github.com/powerapi-ng/hwpc-sensor.git\\ncd hwpc-sensor\\ncmake .\\nmake\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"pip3 install rapl-formula\\n\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h3\",{attrs:{id:\"launch-the-different-component-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#launch-the-different-component-2\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Launch the different component\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v('sudo ./hwpc-sensor -n \"sensor\" -r \"mongodb\" -U \"mongodb://ADDR\" -D \"connection_db\" -C \"hwrep\" -s \"rapl\" -o -e \"RAPL_ENERGY_CORES\" -e \"RAPL_ENERGY_PKG\" -e \"RAPL_ENERGY_GPU\" &\\n')])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"pre\",[t(\"code\",[this._v(\"python3 -m rapl_formula mongodb://ADDR connection_db hwrep mongodb://ADDR output_db power_consumption -s &\\n\")])])}],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}